<!DOCTYPE HTML>
<html>
<head>
    <title>WebAL Sample 04</title>
    <script type="text/javascript" src="../../src/webal.js"></script>
    <script type="text/javascript">
        function DocumentLoaded() {
            var al = WebAL.getContext();

            var contentPath = "../content/";
            var soundFiles = [
                "1up",
                "bonus",
                "coin",
                "gameover",
                "invincible",
                "jump",
                "timewarning"
            ];

            var sources = [];
            for (var n = 0; n < soundFiles.length; n++) {
                var soundSrc = contentPath + soundFiles[n];

                // Use the browser to load the audio
                var audioEl = new Audio();
                var srcmp3 = document.createElement("source")
                srcmp3.src = soundSrc + ".mp3";
                srcmp3.type = "audio/mpeg";
                audioEl.appendChild(srcmp3);
                var srcogg = document.createElement("source");
                srcogg.src = soundSrc + ".ogg";
                srcogg.type = "audio/ogg";
                audioEl.appendChild(srcogg);
                //audioEl.src = soundSrc + ".ogg";

                // Setup buffer with the audio element
                var buffer = al.createBuffer();
                al.bufferData(buffer, audioEl);

                // Bind buffer to source
                var source = al.createSource();
                al.sourceBuffer(source, buffer);

                sources.push(source);
            }

            document.addEventListener("keydown", function (e) {
                var code = e.keyCode || e.charCode;
                if ((code >= 48) && (code <= 57)) {
                    var index = code - 48;
                    if (index >= sources.length) {
                        return;
                    }

                    var source = sources[index];

                    var isPlaying = (al.getSourceParameter(source, al.SOURCE_STATE) == al.PLAYING);
                    var isLooping = (al.getSourceParameter(source, al.LOOPING) == true);
                    if (isPlaying && isLooping) {
                        // Stop looping sounds
                        al.sourceStop(source);
                    } else {
                        // Loop if ctrl is down
                        if (e.ctrlKey) {
                            al.sourceParameter(source, al.LOOPING, true);
                        } else {
                            al.sourceParameter(source, al.LOOPING, false);
                        }

                        // Rewind and play again
                        al.sourceRewind(source);
                        al.sourcePlay(source);
                    }

                    e.preventDefault();
                }
            }, false);
        };
    </script>
</head>
<body onload="DocumentLoaded();">
    Use the number keys to play sounds. Hold ctrl to play with looping.
</body>
</html>
